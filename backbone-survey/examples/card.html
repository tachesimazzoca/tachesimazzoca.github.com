<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>backbone-survey/examples/card</title>
<script type="text/javascript" src="../lib/json2/json2.js"></script>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/underscore/underscore-min.js"></script>
<script type="text/javascript" src="../lib/backbone/backbone-min.js"></script>
<script type="text/javascript" src="../assets/js/backbone-survey.js"></script>
<script type="text/javascript">
(function($) {
  $(function() {
    var survey = new BackboneSurvey.Survey({
      survey: {
        title: "カード回答サンプル"
      , page: 0
      }
    , sections: [
       {
          id: "q1"
        , page: 1
        , question: "Q1. テキストカード設問です"
        , type: BackboneSurvey.QuestionType.CHECKBOX
        , view: "CustomTextCardAnswerView"
        , options: [
            { value: "1", label: "カード1" }
          , { value: "2", label: "カード2" }
          , { value: "3", label: "カード3" }
          , { value: "4", label: "カード4" }
          , { value: "5", label: "カード5" }
          , { value: "0", label: "その他", sub: {} }
          ]
        , singleOptions: ["0"]
        , rules: [
            new BackboneSurvey.RequiredValidator({ message: "選択してください" })
          ]
        }
      , {
          id: "q2"
        , page: 2
        , question: "Q2. 画像カード設問です"
        , type: BackboneSurvey.QuestionType.CHECKBOX
        , view: "CustomImageCardAnswerView"
        , options: [
            { value: "1", label: '<img src="images/red.gif">' }
          , { value: "2", label: '<img src="images/green.gif">' }
          , { value: "3", label: '<img src="images/blue.gif">' }
          , { value: "4", label: '<img src="images/yellow.gif">' }
          , { value: "5", label: '<img src="images/cyan.gif">' }
          , { value: "6", label: '<img src="images/magenta.gif">' }
          , { value: "0", label: "その他", sub: {} }
          ]
        , singleOptions: ["0"]
        , rules: [
            new BackboneSurvey.RequiredValidator({ message: "選択してください" })
          ]
        }
      ]
    }, { parse: true });

    BackboneSurvey.CustomTextCardAnswerView = BackboneSurvey.TextCardAnswerView.extend({
      $dialog: '#survey-dialog'
    });
    BackboneSurvey.CustomImageCardAnswerView = BackboneSurvey.ImageCardAnswerView.extend({
      $dialog: '#survey-dialog'
    });

    var view = new BackboneSurvey.SurveyView({
      model: survey // BackboneSurvey.Survey
    , el: $("#survey-app") // アンケートを表示する jQuery オブジェクト
    });

    // 現在ページ
    var lastPage = survey.sections.lastPage();
    survey.on("change", function() {
      console.log(survey.get("page") + " of " + lastPage);
    });

    view.on("start", function() { survey.startPage() } );
    view.on("prev", function() { survey.prevPage() } );
    view.on("next", function() { survey.nextPage() } );
    view.on("completed", function() {
      console.log(["completed", survey.answers()]);
    });

    // 回答時に SurveyView から answer フックが呼ばれます。
    view.on("answer", function() {
      // SurveyView#isValid で正常回答の判定ができます
      console.log(["answer", view.isValid()]);
    });

    // SurveyView#startPage() でアンケート開始します。
    view.startPage();
  });
})(jQuery);
</script>
</head>
<body>
  <div id="survey-app">
    <h1 class="survey-title"></h1><!-- アンケートタイトル -->
    <div id="survey-sections"></div><!-- アンケート設問(必須) -->
    <input type="button" class="survey-next" value="Next"><!-- 次ページに進みます(必須) -->
    <input type="button" class="survey-prev" value="Prev"><!-- 前ページに戻ります -->
    <p><a class="survey-start" href="javascript:void(0);">はじめからやり直す</a></p>
  </div>
  <div id="survey-dialog" style="display: none; position: absolute; left: 0; top: 0; background: #fff;">
    <p>Customized dialog!</p>
    <input type="text"><button>OK</button>
  </div>
</body>
</html>
